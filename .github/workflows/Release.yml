name: Release

on:
  push:
    branches:
      - master
    path:
      - 'packages/**/package.json'

jobs:
  release:
    runs-on: ubuntu-latest
    # 1. 在job层级设置环境变量（推荐）
    env:
      NPM_TOKEN: ${{ secrets.NPM_TOKEN }}
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Bun
        uses: oven-sh/setup-bun@v1

      - name: Install dependencies
        run: bun install

      - name: Create Release PR or Publish
        id: changesets
        uses: changesets/action@v1
        with:
           publish: bun run publish # 请确保这是你package.json里正确的脚本名
          version: bun run version
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          NPM_TOKEN: ${{ secrets.NPM_TOKEN }}